{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"fs\"","webpack:///external \"path\"","webpack:///external \"chalk\"","webpack:///external \"os\"","webpack:///external \"yargs\"","webpack:///./src/index.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","__webpack_exports__","path__WEBPACK_IMPORTED_MODULE_0__","fs__WEBPACK_IMPORTED_MODULE_1__","os__WEBPACK_IMPORTED_MODULE_2__","chalk__WEBPACK_IMPORTED_MODULE_3__","chalk__WEBPACK_IMPORTED_MODULE_3___default","yargs__WEBPACK_IMPORTED_MODULE_4__","appDir","process","cwd","homeDir","args","pkgConf","env","help","keySourceFile","sourceFile","stages","sourceDir","concat","string","alias","coerce","describe","argv","projectName","keySourceFilePath","Array","isArray","outputPaths","isFileExist","path","console","error","a","magentaBright","exit","forEach","stage","absPath","lines","encoding","split","data","flag","err","log","cyanBright","writeOutput","envKeyValueMap","map","line","match","indexOf","trim","getEnvKeyFromLine","copyRootEnvByKeys","stagePostfix","filter","index","slice","readSource","join","main"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","module.exports = require(\"fs\");","module.exports = require(\"path\");","module.exports = require(\"chalk\");","module.exports = require(\"os\");","module.exports = require(\"yargs\");","import * as path from 'path'\nimport * as fs from 'fs'\nimport * as os from 'os'\nimport chalk from 'chalk'\nimport * as yargs from 'yargs'\n\n//\n// Types\n//\n\ntype EnvValue = string\ninterface EnvKeyValueMap {\n  [EnvKey: string]: EnvValue\n}\ntype Stages = string\n\n//\n// Constants\n//\nconst appDir = process.cwd()\nconst homeDir = os.homedir()\n\nconst args = yargs\n  .version(false)\n  .pkgConf('central-env')\n  .env('CENTRALENV')\n  .help()\n  .default({\n    keySourceFile: '.env.example',\n    sourceFile: '.env',\n    stages: ['development', 'production', 'test'],\n    sourceDir: `${homeDir}/.env`,\n    // stageLess: false,\n  })\n  // .boolean('stageLess')\n  // .alias('l', 'stageLess')\n  .string('projectName')\n  .alias('p', 'projectName')\n  .alias('h', 'help')\n  .alias('k', 'keySourceFile')\n  .alias('d', 'sourceDir')\n  .coerce('stages', (stages) => (stages === true ? '' : stages))\n  .alias('s', 'stages')\n  .describe('projectName', '.env.<projectName>.<stage>').argv\nconsole.debug({ args })\n\nconst projectName = args.projectName ? `.${args.projectName}` : ''\nconsole.debug('project dir is \"%s\"', appDir)\n\nconst keySourceFilePath = path.resolve(appDir, args.keySourceFile)\n\nconst stages = Array.isArray(args.stages) ? args.stages : [args.stages]\nconst outputPaths: { [stage: string]: string } = {}\nstages.forEach((stage) => {\n  const absPath = path.resolve(appDir, stage ? `.env.${stage}` : '.env')\n  console.debug({ stage, absPath })\n  // const absPath = path.resolve(appDir, ['.env', stage].join('.'))\n  outputPaths[stage] = absPath\n})\n\n//\n// Function\n//\n\nfunction isFileExist(path: string): void {\n  if (!fs.existsSync(path)) {\n    console.error(chalk.magentaBright(\"%s doesn't exist!\"), path)\n    process.exit(2)\n  }\n}\nfunction preCheck(): void {\n  isFileExist(keySourceFilePath)\n  // isFileExist(sourceFile)\n}\n\nfunction readEnvFile(): string[] {\n  const lines = fs.readFileSync(keySourceFilePath, { encoding: 'utf8' }).split('\\n')\n  return lines\n}\n\nfunction readSource(stage: Stages): { [EnvKey: string]: string } {\n  const sourceFilename = '.env'\n  const stagePostfix = stage ? `.${stage}` : ''\n  const sourceFile = path.resolve(\n    args.sourceDir,\n    `${sourceFilename}${projectName}${stagePostfix}`,\n  )\n  isFileExist(sourceFile)\n\n  const lines = fs.readFileSync(sourceFile, { encoding: 'utf8' }).split('\\n')\n  const envKeyValueMap: EnvKeyValueMap = {}\n  lines\n    .filter((line) => !line.match(/^#/) && !line.match(/^[ \\t]*$/))\n    .forEach((line) => {\n      // split line to [key & value]\n      const index = line.indexOf('=')\n      const key = line.slice(0, index)\n      const value = line.slice(index + 1)\n      console.debug({ line, key, value })\n\n      envKeyValueMap[key] = value\n    })\n  return envKeyValueMap\n}\n\n/**\n * ## Supported lines example (with \"=\" | without \"=\")\n *\n * - SOME_KEY\n * - SOME_KEY=SOME_VALUE\n */\nfunction getEnvKeyFromLine(line: string) {\n  return line.indexOf('=') ? line.split('=', 1)[0] : line.trim()\n}\nfunction copyRootEnvByKeys(envKeyValueMap: EnvKeyValueMap, lines: string[]): string[] {\n  const res = lines.map((line) => {\n    // return comment line without change, to keep format\n    if (line.match(/^#/)) return line\n    if (line.match(/^[ \\t]*$/)) return line\n\n    const key = getEnvKeyFromLine(line)\n    const value = envKeyValueMap[key] || ''\n    console.debug({ key, value })\n    return `${key}=${value}`\n  })\n  // console.debug()\n\n  return res\n}\n\nfunction writeOutput(path: string, data: string): void {\n  fs.writeFile(path, data, { encoding: 'utf8', flag: 'w' }, (err) => {\n    if (err) console.error(err)\n    console.log(chalk.cyanBright('\"%s\" created'), path)\n  })\n}\n\nfunction main() {\n  preCheck()\n  const lines = readEnvFile()\n\n  stages.forEach((stage) => {\n    const path = outputPaths[stage]\n    const envKeyValueMap = readSource(stage)\n    console.debug({ envKeyValueMap })\n    const copied = copyRootEnvByKeys(envKeyValueMap, lines)\n    const data = copied.join('\\n')\n    writeOutput(path, data)\n  })\n}\n\nmain()\n"],"sourceRoot":""}